<!doctype html>
<html>
<head> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script type="text/javascript">
  var conn = [];

  function init(num) {
      $("#connect" + num).click(function() {
          var name = $("#username" + num).val();
          var pass = $("#password" + num).val();
          
          conn[num] = new WebSocket("ws://localhost:8080/ws");
          conn[num].onmessage = function(e) {
              $("#chat" + num).append('<p class="text-primary">' + e.data + '</p>');
              var msg = $.parseJSON(e.data);
              switch (msg.type) {
                  case "hello":
                      conn[num].send(
                          JSON.stringify(
                              {type: "auth", 
                               user: name,
                               pass: pass}));
                      break;
              }
          };
      });

      $("#message" + num).change(function(e) {
          var text = $(this).val();
          var chan = $("#channel" + num).val();

          var msg = JSON.stringify(
                  {
                      type: "message",
                      user: "user2",
                      text: text,
                      channel: chan
                  });

          conn[num].send(msg);
      });

      $("#disconnect" + num).click(function() {
          conn[num].close();
      });
  }

  $(document).ready(function() {
      init(1);
      init(2);
  });
  </script>
</head>
<body>
<br/>
<div class="container">
  <div class="row">
    <div class="col-md-4">
      <div class="panel panel-default">
        <div class="panel-body">
          <h4>Channels</h4>
          <ul class="list-group">
            <li class="list-group-item">
              <a href="#">User1</a>
            </li>
            <li class="list-group-item">User3<span class="badge">3</span></li>
            <li class="list-group-item">User2</li>
          </ul>
        </div>
      </div>
    </div>
    <div class="col-md-8">
      <div class="panel panel-default">
        <div class="panel-body">
          <div id="chat" style="height: 300px">
          </div>
          <input type="text" class="form-control" placeholder="Hey">
        </div>
      </div>
    </div>
  </div>
</div>
<div id="create-channel" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Modal title</h4>
      </div>
      <div class="modal-body">
        <p>One fine body&hellip;</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
</body>
</html>
